<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CrewLedger{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ cache_version }}">
    {% block head %}{% endblock %}
</head>
<body>
    <!-- Layer 1 — Module Selector Bar -->
    <nav class="module-bar">
        <div class="module-bar__inner">
            <span class="module-bar__brand">CrewOS</span>
            <div class="module-bar__tabs">
                {% for mod in crewos_modules %}
                {% if mod.enabled %}
                <a href="{{ mod.href }}" class="module-bar__tab {% if active_module is defined and active_module == mod.id %}module-bar__tab--active{% endif %}">{{ mod.label }}</a>
                {% else %}
                <span class="module-bar__tab module-bar__tab--disabled">{{ mod.label }}</span>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </nav>

    <!-- Layer 2 — Module Sub-Nav -->
    {% if module_nav is defined and module_nav %}
    <nav class="subnav">
        <div class="subnav__inner">
            {% for item in module_nav %}
            <a href="{{ item.href }}" class="subnav__tab {% if active_subnav is defined and active_subnav == item.id %}subnav__tab--active{% endif %}">{{ item.label }}</a>
            {% endfor %}
        </div>
    </nav>
    {% endif %}

    <!-- Main Content -->
    <main class="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Receipt Image Modal -->
    <div id="receipt-modal" class="modal" style="display:none;">
        <div class="modal-backdrop" onclick="closeReceiptModal()"></div>
        <button id="modal-nav-prev" class="modal-nav modal-nav--prev" style="display:none;" onclick="navigateReceipt(-1)" aria-label="Previous receipt">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <button id="modal-nav-next" class="modal-nav modal-nav--next" style="display:none;" onclick="navigateReceipt(1)" aria-label="Next receipt">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
        <div class="modal-content">
            <button class="modal-close" onclick="closeReceiptModal()">&times;</button>
            <div class="modal-body">
                <div class="modal-image-wrap">
                    <img id="modal-receipt-image" src="" alt="Receipt image">
                </div>
                <div class="modal-details" id="modal-receipt-details">
                    <!-- Filled by JS -->
                </div>
            </div>
            <div class="modal-footer" id="modal-receipt-footer">
                <!-- Edit/audit buttons filled by JS -->
            </div>
        </div>
    </div>

    {% block pre_scripts %}{% endblock %}
    <script src="{{ url_for('static', filename='js/app.js') }}?v={{ cache_version }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
